tinymce.PluginManager.requireLangPack("blockquote");tinymce.PluginManager.add("blockquote",function(d){var e=false,b=false,c={};function a(){var h=d.selection,k=d.dom,l,g,f;c={quote:"",author:"",linkLabel:"",linkUrl:""};e=h.getNode();if(e.nodeName=="BODY"){b=false}else{b=true;try{while(k.getParent(e).parentNode){e=k.getParent(e).parentNode;if(e.nodeName=="BLOCKQUOTE"){for(g=0;g<e.childNodes.length;g++){l=e.childNodes[g];if(l.nodeName!="CITE"){c.quote+=l.textContent}else{f=l.getElementsByTagName("a");if(f.length>0){c.linkUrl=f[0].href;c.linkLabel=f[0].textContent}c.author=l.textContent;if(c.linkLabel!=""){c.author=c.author.replace(c.linkLabel,"")}}}break}}}catch(j){e=k.getParent(h.getNode());c.quote=e.textContent}}d.windowManager.open({title:"Quote",data:c,body:[{type:"label",text:"Quote :"},{name:"quote",type:"textbox",minHeight:150,minWidth:500,multiline:true},{type:"label",text:"Cite :"},{name:"author",type:"textbox"},{type:"label",text:"Link label :"},{name:"linkLabel",type:"textbox"},{type:"label",text:"Link url :"},{name:"linkUrl",type:"textbox"}],onsubmit:function(p){var m=p.data.quote.replace(/(\r|\r\n|\n)/g,"<br />"),o=p.data.author,n=p.data.linkLabel,i=p.data.linkUrl;o=(o!="")?o+" ":"";n=(n!="")?n:i;n=(i!="")?'<a href="'+i+'">'+n+"</a>":"";if(o!=""||n!=""||i!=""){o="<cite>"+o+n+"</cite>"}if(b==true){d.dom.remove(e)}d.insertContent("<blockquote><p>"+m+"</p>"+o+"</blockquote><p>&nbsp;</p>",{format:"raw"})}})}d.addButton("blockquote",{icon:"blockquote",tooltip:"Insert Quote",onclick:function(){a()}});d.addMenuItem("blockquote",{text:"Quote",icon:"blockquote",context:"insert",onclick:function(){a()}})});